# Community-Governed Bluesky Feed - Environment Template
#
# Copy to .env and fill required values:
#   cp .env.example .env
#
# Required values are marked REQUIRED. Others are optional with defaults.

# ============================================================================
# Identity (REQUIRED)
# ============================================================================

# Feed generator service DID. Prefer did:plc.
# Bootstrap helper:
#   npm run generate-feed-did -- your-handle.bsky.social
FEEDGEN_SERVICE_DID="did:plc:xxxxxxxxxxxxxxxxxxxxxxxx"

# DID that owns the app.bsky.feed.generator record (usually your bot account DID).
FEEDGEN_PUBLISHER_DID="did:plc:yyyyyyyyyyyyyyyyyyyyyyyy"

# Public hostname where this service is served over HTTPS.
FEEDGEN_HOSTNAME="feed.yourdomain.com"

# ============================================================================
# Server
# ============================================================================

# API/UI listening port
FEEDGEN_PORT=3000

# Listening host
FEEDGEN_LISTENHOST="0.0.0.0"

# ============================================================================
# Jetstream (REQUIRED)
# ============================================================================

# Primary and fallback Jetstream endpoints
JETSTREAM_URL="wss://jetstream2.us-east.bsky.network/subscribe"
JETSTREAM_FALLBACK_URL="wss://jetstream1.us-east.bsky.network/subscribe"

# Comma-separated collection list
JETSTREAM_COLLECTIONS="app.bsky.feed.post,app.bsky.feed.like,app.bsky.feed.repost,app.bsky.graph.follow"

# ============================================================================
# Database + Cache (REQUIRED)
# ============================================================================

# PostgreSQL connection string
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/community_feed"

# Redis connection string
REDIS_URL="redis://localhost:6379"

# ============================================================================
# Bluesky Publisher Account (REQUIRED)
# ============================================================================

# Handle/login for publishing/updating feed generator records
BSKY_IDENTIFIER="your-bot-handle.bsky.social"

# App password (never your main Bluesky password)
BSKY_APP_PASSWORD="xxxx-xxxx-xxxx-xxxx"

# ============================================================================
# Feed Request JWT Verification
# ============================================================================

# Override audience for feed request JWTs.
# Leave empty to default to FEEDGEN_SERVICE_DID.
FEED_JWT_AUDIENCE=""

# Allowed issuer DID prefixes, comma-separated.
FEED_JWT_ALLOWED_ISSUER_PREFIXES="did:plc:"

# Allowed future skew for iat/nbf validation (seconds)
FEED_JWT_MAX_FUTURE_SKEW_SECONDS=300

# ============================================================================
# Scoring
# ============================================================================

# Scheduler cron for scoring runs
SCORING_INTERVAL_CRON="*/5 * * * *"

# Optional fallback scheduler interval (ms)
SCORING_INTERVAL_MS=300000

# Lookback window for candidate posts
SCORING_WINDOW_HOURS=72

# Max ranked posts cached to Redis for feed serving
FEED_MAX_POSTS=1000

# ============================================================================
# Governance
# ============================================================================

# Minimum votes needed before governance transition
GOVERNANCE_MIN_VOTES=5

# Voting period length in hours
GOVERNANCE_PERIOD_HOURS=168

# Optional Polis conversation id
POLIS_CONVERSATION_ID=""

# ============================================================================
# Runtime / Security
# ============================================================================

# debug | info | warn | error
LOG_LEVEL="info"

# development | production | test
NODE_ENV="development"

# Fastify trustProxy setting.
# Examples: "loopback", "127.0.0.1", "10.0.0.0/8", "true", "false", "1"
TRUST_PROXY="loopback"

# Browser CORS allowlist (comma-separated exact origins).
# Example: "https://feed.yourdomain.com,https://www.yourdomain.com"
# If empty, app uses environment-specific defaults.
CORS_ALLOWED_ORIGINS=""

# Governance session cookie settings
GOVERNANCE_SESSION_COOKIE_NAME="governance_session"
GOVERNANCE_SESSION_COOKIE_SAME_SITE="lax"

# ============================================================================
# API Rate Limiting
# ============================================================================

RATE_LIMIT_ENABLED=true
RATE_LIMIT_GLOBAL_MAX=200
RATE_LIMIT_GLOBAL_WINDOW_MS=60000
RATE_LIMIT_LOGIN_MAX=10
RATE_LIMIT_LOGIN_WINDOW_MS=60000
RATE_LIMIT_VOTE_MAX=20
RATE_LIMIT_VOTE_WINDOW_MS=60000
RATE_LIMIT_ADMIN_MAX=30
RATE_LIMIT_ADMIN_WINDOW_MS=60000
RATE_LIMIT_ADMIN_CRITICAL_MAX=10
RATE_LIMIT_ADMIN_CRITICAL_WINDOW_MS=60000

# ============================================================================
# Announcement Bot
# ============================================================================

# Enable automatic governance announcements
BOT_ENABLED=false

# Bot handle (can be same as BSKY_IDENTIFIER)
BOT_HANDLE="feed-announcements.bsky.social"

# Bot app password
BOT_APP_PASSWORD="xxxx-xxxx-xxxx-xxxx"

# Comma-separated admin DID allowlist
BOT_ADMIN_DIDS="did:plc:youradmindid"

# Pin duration for announcement posts in feed (hours)
BOT_PIN_TTL_HOURS=24

# ============================================================================
# Optional Script Helpers
# ============================================================================

# Used by scripts/load-test.ts
# FEED_URI="at://did:plc:yourpublisherdid/app.bsky.feed.generator/community-gov"
